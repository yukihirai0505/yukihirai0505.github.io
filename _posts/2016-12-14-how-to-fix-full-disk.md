---
layout: post
title:  "ディスク容量がいっぱいのときの即時対処"
date:   2016-12-14 12:00:00 +0900
categories: Development
---

今回はディスク容量がいっぱいになって
システムダウンしているとき即時対処について
メモしておきます。

## ディスク容量がいっぱいでシステムダウンするとき

ディスク容量がいっぱいになるとシステムに以上を来して
ダウンすることもあります。
これが本番の環境なら緊急性が高いのですぐに復旧したいところです。

今回は根本の解決というより即時復旧の対応について記載してみます。

## どのdirがいっぱいになているのかを確認する

まずは `du -sh` コマンドでどのdirectoryが容量を食っているのかを確認します。

## 対象ディレクトリのファイルを確認

対象ディレクトリのファイルの確認してerror.logなどがあれば中身を見るようにしましょう。
プログラムのエラーとかではなくログが大量に吐き出されているなどの場合は
一度システムを再起動してみます。(苦肉の策)

あとは不要なファイルを削除するなどしてディスクの容量を軽くしてあげます。

## とりあえずの予防策


- ログローテートをいれる
- ディスク容量のアラートを設定する

AWSの場合はカスタム設定で、CloudWatchにディスク容量のアラートを設定することができます。
下記記事が参考になります。

- [AWS CloudWatchでディスク容量チェック - Septeni Engineer's Blog](http://labs.septeni.co.jp/entry/20141212/1418321528)

初めて実行する場合はいくつかperlのモジュールが足りなくてうまくいかないことがあるかもしれないので、
足りないものはエラーログをみて適宜インストールしていきましょう。

また、 `install Crypt::SSLeay` のテストがうまくいかないことがありますが、
TESTをNOにすればいけるそうです。←
あまりよろしくなさそうですが。笑

[How to Force Install a Perl Module using CPAN](http://www.thegeekstuff.com/2013/06/cpan-force-install-perl-module)

qt: `fforce install Net::SSLeay`